<!doctype html>
<meta charset="UTF-8">
<script src="node_modules/codemirror/lib/codemirror.js"></script>
<script src="node_modules/codemirror/mode/javascript/javascript.js"></script>
<link rel=stylesheet href="node_modules/codemirror/lib/codemirror.css">
<script src="node_modules/acorn/acorn.js"></script>
<script src="node_modules/acorn/acorn_loose.js"></script>
<script src="node_modules/acorn/util/walk.js"></script>
<script src="infer.js"></script>
<title>Tern demo</title>
<style>.CodeMirror { border: 1px solid silver; }</style>

<textarea id=code>
var foo = (function() {
  return 42;
})();

var x = {};

function init(v) {
  v.foo = 10;
  v.bar = 1 + 1;
}

init(x);
</textarea>
<button onclick="analyze()">Analyze</button>
<pre id=out></pre>

<script>
  var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
    lineNumbers: true,
    extraKeys: {"Ctrl-Space": analyze}
  });
  function load(file) {
    var xhr = new XMLHttpRequest();
    xhr.open("get", file, false);
    xhr.send();
    return xhr.responseText;
  }
  var ecma5 = JSON.parse(load("ecma5.json")), browser = JSON.parse(load("browser.json"));
  function analyze() {
    editor.focus();
    var out = document.getElementById("out");
    var cx = new tern.Context([ecma5, browser]);
    tern.withContext(cx, function() {
      var data = tern.analyze(editor.getValue());
      var tp = tern.expressionType(data.ast, editor.indexFromPos(editor.getCursor()));
      out.innerHTML = tp ? tp.toString(2) : "not found";
    });
  }
</script>
